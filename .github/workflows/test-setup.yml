name: Test Setup Scripts

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  test-macos:
    name: Test macOS Setup (Phase ${{ matrix.phase }})
    runs-on: macos-latest
    strategy:
      fail-fast: false
      matrix:
        phase: [1, 2, 3, 4, 5]
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Make scripts executable
        run: |
          chmod +x mac/setup_mac.sh
          chmod +x scripts/*.sh
          chmod +x scripts/*.py
      
      - name: Phase 1 - Package Manager
        if: matrix.phase == 1
        run: |
          echo "Testing Phase 1: Package Manager Installation"
          ./scripts/install_package_manager.sh || echo "Phase 1 completed (may have warnings)"
      
      - name: Verify Phase 1 - Homebrew Installed
        if: matrix.phase == 1
        run: |
          echo "Verifying Homebrew installation..."
          if command -v brew &> /dev/null; then
            echo "✓ Homebrew is installed: $(which brew)"
            echo "✓ Homebrew version: $(brew --version | head -n1)"
          else
            echo "✗ Homebrew is NOT installed"
            exit 1
          fi
      
      - name: Phase 2 - Essential Tools
        if: matrix.phase == 2
        run: |
          echo "Testing Phase 2: Essential Tools Installation"
          # Install Homebrew first if not present
          if ! command -v brew &> /dev/null; then
            echo "Installing Homebrew for testing..."
            /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)" || true
            eval "$(/opt/homebrew/bin/brew shellenv)" || eval "$(/usr/local/bin/brew shellenv)" || true
          fi
          # Test with config file (non-interactive)
          echo "y" | ./scripts/install_essential_tools.sh || echo "Phase 2 completed (may have warnings)"
      
      - name: Verify Phase 2 - Essential Tools Installed
        if: matrix.phase == 2
        run: |
          echo "Verifying essential tools installation..."
          # Add Homebrew to PATH if needed
          if [ -f "/opt/homebrew/bin/brew" ]; then
            eval "$(/opt/homebrew/bin/brew shellenv)"
          elif [ -f "/usr/local/bin/brew" ]; then
            eval "$(/usr/local/bin/brew shellenv)"
          fi
          
          # Critical tools that must be installed
          CRITICAL_TOOLS=("git" "curl" "wget")
          CRITICAL_FAILED=0
          for tool in "${CRITICAL_TOOLS[@]}"; do
            if command -v "$tool" &> /dev/null; then
              echo "✓ $tool is installed: $(which $tool)"
            else
              echo "✗ $tool is NOT installed (CRITICAL)"
              CRITICAL_FAILED=1
            fi
          done
          
          # Important tools (warnings if missing, but don't fail)
          IMPORTANT_TOOLS=("zsh" "jq" "tree" "htop" "yadm")
          for tool in "${IMPORTANT_TOOLS[@]}"; do
            if command -v "$tool" &> /dev/null; then
              echo "✓ $tool is installed: $(which $tool)"
            else
              echo "⚠ $tool is NOT installed (may need manual installation)"
            fi
          done
          
          # Check for neovim (not vim) on macOS
          if command -v nvim &> /dev/null; then
            echo "✓ neovim is installed: $(which nvim)"
          else
            echo "⚠ neovim is NOT installed (may need manual installation)"
          fi
          
          # Optional tools (check for both command names)
          if command -v rg &> /dev/null; then
            echo "✓ ripgrep is installed (as 'rg'): $(which rg)"
          elif command -v ripgrep &> /dev/null; then
            echo "✓ ripgrep is installed: $(which ripgrep)"
          else
            echo "⚠ ripgrep is NOT installed (optional)"
          fi
          
          if command -v fd &> /dev/null; then
            echo "✓ fd is installed: $(which fd)"
          else
            echo "⚠ fd is NOT installed (optional)"
          fi
          
          # Check Homebrew packages
          if command -v brew &> /dev/null; then
            echo "Checking Homebrew packages..."
            BREW_TOOLS=("git" "zsh" "neovim" "curl" "wget" "jq" "tree" "htop" "ripgrep" "fd" "bat" "exa" "yadm")
            for tool in "${BREW_TOOLS[@]}"; do
              if brew list "$tool" &> /dev/null 2>&1; then
                echo "✓ $tool is installed via Homebrew"
              else
                echo "⚠ $tool is not installed via Homebrew (may be system tool)"
              fi
            done
          fi
          
          if [ $CRITICAL_FAILED -eq 1 ]; then
            echo "ERROR: Critical tools are missing!"
            exit 1
          fi
          
          echo "✓ Verification complete (some optional tools may be missing)"
      
      - name: Phase 3 - Shell Setup
        if: matrix.phase == 3
        run: |
          echo "Testing Phase 3: Shell Setup"
          # Install Homebrew if needed
          if ! command -v brew &> /dev/null; then
            /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)" || true
            eval "$(/opt/homebrew/bin/brew shellenv)" || eval "$(/usr/local/bin/brew shellenv)" || true
          fi
          echo "y" | ./scripts/setup_shell.sh || echo "Phase 3 completed (may have warnings)"
      
      - name: Verify Phase 3 - Shell Setup
        if: matrix.phase == 3
        run: |
          echo "Verifying shell setup..."
          
          # Check zsh is installed (important but not critical if skipped)
          if command -v zsh &> /dev/null; then
            echo "✓ zsh is installed: $(which zsh)"
            echo "✓ zsh version: $(zsh --version)"
          else
            echo "⚠ zsh is NOT installed (may have been skipped or failed)"
            echo "  This is expected if the installation was skipped"
          fi
          
          # Check Oh My Zsh
          if [ -d "$HOME/.oh-my-zsh" ]; then
            echo "✓ Oh My Zsh is installed"
          else
            echo "⚠ Oh My Zsh is NOT installed (may have been skipped)"
          fi
          
          # Check default shell (may not be changed in CI)
          CURRENT_SHELL=$(echo $SHELL)
          echo "Current shell: $CURRENT_SHELL"
          
          echo "✓ Shell setup verification complete"
      
      - name: Phase 4 - Development Environments
        if: matrix.phase == 4
        run: |
          echo "Testing Phase 4: Development Environments"
          # Install Homebrew if needed
          if ! command -v brew &> /dev/null; then
            /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)" || true
            eval "$(/opt/homebrew/bin/brew shellenv)" || eval "$(/usr/local/bin/brew shellenv)" || true
          fi
          echo "y" | ./scripts/setup_python.sh || echo "Python setup skipped"
          echo "y" | ./scripts/setup_nodejs.sh || echo "Node.js setup skipped"
      
      - name: Verify Phase 4 - Development Environments
        if: matrix.phase == 4
        run: |
          echo "Verifying development environments..."
          
          # Verify Python
          if command -v python3 &> /dev/null; then
            echo "✓ Python3 is installed: $(which python3)"
            echo "✓ Python3 version: $(python3 --version)"
            
            # Check pip packages
            if command -v pip3 &> /dev/null; then
              echo "✓ pip3 is installed: $(which pip3)"
              PYTHON_PACKAGES=("ipython" "jupyter" "black" "flake8" "pytest" "virtualenv")
              for pkg in "${PYTHON_PACKAGES[@]}"; do
                if pip3 list --user 2>/dev/null | grep -q "^$pkg "; then
                  echo "✓ Python package $pkg is installed"
                else
                  echo "⚠ Python package $pkg is NOT installed"
                fi
              done
            else
              echo "⚠ pip3 is NOT installed"
            fi
          else
            echo "✗ Python3 is NOT installed"
          fi
          
          # Verify Node.js
          if command -v node &> /dev/null; then
            echo "✓ Node.js is installed: $(which node)"
            echo "✓ Node.js version: $(node --version)"
            
            if command -v npm &> /dev/null; then
              echo "✓ npm is installed: $(which npm)"
              echo "✓ npm version: $(npm --version)"
              
              # Check npm packages
              NPM_PACKAGES=("yarn" "typescript" "eslint" "prettier")
              for pkg in "${NPM_PACKAGES[@]}"; do
                if npm list -g "$pkg" &> /dev/null 2>&1; then
                  echo "✓ npm package $pkg is installed globally"
                else
                  echo "⚠ npm package $pkg is NOT installed globally"
                fi
              done
            else
              echo "⚠ npm is NOT installed"
            fi
          else
            echo "⚠ Node.js is NOT installed (may have been skipped)"
          fi
      
      - name: Phase 5 - Conda/Mamba Setup
        if: matrix.phase == 5
        run: |
          echo "Testing Phase 5: Conda/Mamba Setup"
          # Install Homebrew if needed
          if ! command -v brew &> /dev/null; then
            /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)" || true
            eval "$(/opt/homebrew/bin/brew shellenv)" || eval "$(/usr/local/bin/brew shellenv)" || true
          fi
          echo "y" | ./scripts/setup_conda.sh || echo "Conda setup skipped"
      
      - name: Verify Phase 5 - Conda Environment
        if: matrix.phase == 5
        run: |
          echo "Verifying conda/mamba setup..."
          
          # Check for conda/mamba
          if command -v conda &> /dev/null; then
            echo "✓ conda is installed: $(which conda)"
            echo "✓ conda version: $(conda --version)"
            
            # Initialize conda if needed
            if [ -f "$HOME/mambaforge/etc/profile.d/conda.sh" ]; then
              source "$HOME/mambaforge/etc/profile.d/conda.sh"
            elif [ -f "$HOME/miniconda3/etc/profile.d/conda.sh" ]; then
              source "$HOME/miniconda3/etc/profile.d/conda.sh"
            fi
            
            # Check for py3 environment
            if conda env list | grep -q "^py3 "; then
              echo "✓ Conda environment 'py3' exists"
              
              # Activate and check packages
              conda activate py3 || true
              CONDA_PACKAGES=("python" "numpy" "pandas" "jupyter")
              for pkg in "${CONDA_PACKAGES[@]}"; do
                if conda list -n py3 | grep -q "^$pkg "; then
                  echo "✓ Conda package $pkg is installed in py3"
                else
                  echo "⚠ Conda package $pkg is NOT installed in py3"
                fi
              done
            else
              echo "✗ Conda environment 'py3' does NOT exist"
              exit 1
            fi
          elif command -v mamba &> /dev/null; then
            echo "✓ mamba is installed: $(which mamba)"
            echo "✓ mamba version: $(mamba --version)"
          else
            echo "⚠ conda/mamba is NOT installed (may have been skipped)"
          fi
      
      - name: Verify yadm and Dotfiles
        if: matrix.phase == 2 || matrix.phase == 3
        run: |
          echo "Verifying yadm setup..."
          
          if command -v yadm &> /dev/null; then
            echo "✓ yadm is installed: $(which yadm)"
            echo "✓ yadm version: $(yadm --version)"
            
            # Check if yadm repo exists
            if yadm rev-parse --git-dir &> /dev/null; then
              echo "✓ yadm repository is initialized"
              
              # Check for remote
              REMOTE=$(yadm remote get-url origin 2>/dev/null || echo "")
              if [ -n "$REMOTE" ]; then
                echo "✓ yadm remote is set: $REMOTE"
              else
                echo "⚠ yadm remote is NOT set"
              fi
              
              # Check for common dotfiles
              DOTFILES=(".zshrc" ".gitconfig" ".config")
              for dotfile in "${DOTFILES[@]}"; do
                if [ -f "$HOME/$dotfile" ] || [ -d "$HOME/$dotfile" ]; then
                  echo "✓ Dotfile $dotfile exists"
                else
                  echo "⚠ Dotfile $dotfile does NOT exist (may not be cloned yet)"
                fi
              done
            else
              echo "⚠ yadm repository is NOT initialized"
            fi
          else
            echo "⚠ yadm is NOT installed"
          fi
      
      - name: Verify Scripts Exist
        run: |
          echo "Verifying all scripts are present and executable..."
          test -f mac/setup_mac.sh && echo "✓ mac/setup_mac.sh exists"
          test -f scripts/install_package_manager.sh && echo "✓ install_package_manager.sh exists"
          test -f scripts/install_essential_tools.sh && echo "✓ install_essential_tools.sh exists"
          test -f scripts/setup_shell.sh && echo "✓ setup_shell.sh exists"
          test -f scripts/setup_python.sh && echo "✓ setup_python.sh exists"
          test -f scripts/setup_nodejs.sh && echo "✓ setup_nodejs.sh exists"
          test -f scripts/setup_conda.sh && echo "✓ setup_conda.sh exists"
          test -f config/homebrew.yml && echo "✓ config/homebrew.yml exists"
          test -f config/conda.yml && echo "✓ config/conda.yml exists"
          test -f common/lib.sh && echo "✓ common/lib.sh exists"

  test-linux:
    name: Test Linux Setup (Phase ${{ matrix.phase }})
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, ubuntu-22.04]
        phase: [1, 2, 3, 4, 5]
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Make scripts executable
        run: |
          chmod +x linux/setup_linux.sh
          chmod +x scripts/*.sh
          chmod +x scripts/*.py
      
      - name: Phase 1 - Package Manager Detection
        if: matrix.phase == 1
        run: |
          echo "Testing Phase 1: Package Manager Detection"
          ./scripts/install_package_manager.sh || echo "Phase 1 completed (detection only)"
      
      - name: Verify Phase 1 - Package Manager
        if: matrix.phase == 1
        run: |
          echo "Verifying package manager detection..."
          if command -v apt-get &> /dev/null; then
            echo "✓ apt-get detected: $(which apt-get)"
          elif command -v yum &> /dev/null; then
            echo "✓ yum detected: $(which yum)"
          elif command -v dnf &> /dev/null; then
            echo "✓ dnf detected: $(which dnf)"
          elif command -v pacman &> /dev/null; then
            echo "✓ pacman detected: $(which pacman)"
          elif command -v zypper &> /dev/null; then
            echo "✓ zypper detected: $(which zypper)"
          else
            echo "⚠ No known package manager detected"
          fi
      
      - name: Phase 2 - Essential Tools
        if: matrix.phase == 2
        run: |
          echo "Testing Phase 2: Essential Tools Installation"
          echo "y" | ./scripts/install_essential_tools.sh || echo "Phase 2 completed (may have warnings)"
      
      - name: Verify Phase 2 - Essential Tools Installed
        if: matrix.phase == 2
        run: |
          echo "Verifying essential tools installation..."
          
          # Critical tools that must be installed
          CRITICAL_TOOLS=("git" "curl" "wget")
          CRITICAL_FAILED=0
          for tool in "${CRITICAL_TOOLS[@]}"; do
            if command -v "$tool" &> /dev/null; then
              echo "✓ $tool is installed: $(which $tool)"
            else
              echo "✗ $tool is NOT installed (CRITICAL)"
              CRITICAL_FAILED=1
            fi
          done
          
          # Important tools (warnings if missing, but don't fail)
          IMPORTANT_TOOLS=("zsh" "vim" "jq" "tree" "htop" "yadm")
          for tool in "${IMPORTANT_TOOLS[@]}"; do
            if command -v "$tool" &> /dev/null; then
              echo "✓ $tool is installed: $(which $tool)"
            else
              echo "⚠ $tool is NOT installed (may need manual installation)"
            fi
          done
          
          # Optional tools (may have different names on Linux)
          if command -v rg &> /dev/null || command -v ripgrep &> /dev/null; then
            echo "✓ ripgrep is installed"
          else
            echo "⚠ ripgrep is NOT installed (optional)"
          fi
          
          if command -v fdfind &> /dev/null || command -v fd &> /dev/null; then
            echo "✓ fd is installed"
          else
            echo "⚠ fd is NOT installed (optional)"
          fi
          
          if [ $CRITICAL_FAILED -eq 1 ]; then
            echo "ERROR: Critical tools are missing!"
            exit 1
          fi
          
          echo "✓ Verification complete (some optional tools may be missing)"
      
      - name: Phase 3 - Shell Setup
        if: matrix.phase == 3
        run: |
          echo "Testing Phase 3: Shell Setup"
          echo "y" | ./scripts/setup_shell.sh || echo "Phase 3 completed (may have warnings)"
      
      - name: Verify Phase 3 - Shell Setup
        if: matrix.phase == 3
        run: |
          echo "Verifying shell setup..."
          
          # Check zsh is installed (important but not critical if skipped)
          if command -v zsh &> /dev/null; then
            echo "✓ zsh is installed: $(which zsh)"
            echo "✓ zsh version: $(zsh --version)"
          else
            echo "⚠ zsh is NOT installed (may have been skipped or failed)"
            echo "  This is expected if the installation was skipped"
          fi
          
          # Check Oh My Zsh
          if [ -d "$HOME/.oh-my-zsh" ]; then
            echo "✓ Oh My Zsh is installed"
          else
            echo "⚠ Oh My Zsh is NOT installed (may have been skipped)"
          fi
          
          echo "✓ Shell setup verification complete"
      
      - name: Phase 4 - Development Environments
        if: matrix.phase == 4
        run: |
          echo "Testing Phase 4: Development Environments"
          echo "y" | ./scripts/setup_python.sh || echo "Python setup skipped"
          echo "y" | ./scripts/setup_nodejs.sh || echo "Node.js setup skipped"
      
      - name: Verify Phase 4 - Development Environments
        if: matrix.phase == 4
        run: |
          echo "Verifying development environments..."
          
          # Verify Python
          if command -v python3 &> /dev/null; then
            echo "✓ Python3 is installed: $(which python3)"
            echo "✓ Python3 version: $(python3 --version)"
            
            # Check pip packages
            if command -v pip3 &> /dev/null; then
              echo "✓ pip3 is installed: $(which pip3)"
              PYTHON_PACKAGES=("ipython" "jupyter" "black" "flake8" "pytest" "virtualenv")
              for pkg in "${PYTHON_PACKAGES[@]}"; do
                if pip3 list --user 2>/dev/null | grep -q "^$pkg "; then
                  echo "✓ Python package $pkg is installed"
                else
                  echo "⚠ Python package $pkg is NOT installed"
                fi
              done
            else
              echo "⚠ pip3 is NOT installed"
            fi
          else
            echo "⚠ Python3 is NOT installed (may have been skipped)"
          fi
          
          # Verify Node.js
          if command -v node &> /dev/null; then
            echo "✓ Node.js is installed: $(which node)"
            echo "✓ Node.js version: $(node --version)"
            
            if command -v npm &> /dev/null; then
              echo "✓ npm is installed: $(which npm)"
              echo "✓ npm version: $(npm --version)"
              
              # Check npm packages
              NPM_PACKAGES=("yarn" "typescript" "eslint" "prettier")
              for pkg in "${NPM_PACKAGES[@]}"; do
                if npm list -g "$pkg" &> /dev/null 2>&1; then
                  echo "✓ npm package $pkg is installed globally"
                else
                  echo "⚠ npm package $pkg is NOT installed globally"
                fi
              done
            else
              echo "⚠ npm is NOT installed"
            fi
          else
            echo "⚠ Node.js is NOT installed (may have been skipped)"
          fi
      
      - name: Phase 5 - Conda/Mamba Setup
        if: matrix.phase == 5
        run: |
          echo "Testing Phase 5: Conda/Mamba Setup"
          echo "y" | ./scripts/setup_conda.sh || echo "Conda setup skipped"
      
      - name: Verify Phase 5 - Conda Environment
        if: matrix.phase == 5
        run: |
          echo "Verifying conda/mamba setup..."
          
          # Check for conda/mamba
          if command -v conda &> /dev/null; then
            echo "✓ conda is installed: $(which conda)"
            echo "✓ conda version: $(conda --version)"
            
            # Initialize conda if needed
            if [ -f "$HOME/mambaforge/etc/profile.d/conda.sh" ]; then
              source "$HOME/mambaforge/etc/profile.d/conda.sh"
            elif [ -f "$HOME/miniconda3/etc/profile.d/conda.sh" ]; then
              source "$HOME/miniconda3/etc/profile.d/conda.sh"
            fi
            
            # Check for py3 environment
            if conda env list | grep -q "^py3 "; then
              echo "✓ Conda environment 'py3' exists"
              
              # Activate and check packages
              conda activate py3 || true
              CONDA_PACKAGES=("python" "numpy" "pandas" "jupyter")
              for pkg in "${CONDA_PACKAGES[@]}"; do
                if conda list -n py3 | grep -q "^$pkg "; then
                  echo "✓ Conda package $pkg is installed in py3"
                else
                  echo "⚠ Conda package $pkg is NOT installed in py3"
                fi
              done
            else
              echo "✗ Conda environment 'py3' does NOT exist"
              exit 1
            fi
          elif command -v mamba &> /dev/null; then
            echo "✓ mamba is installed: $(which mamba)"
            echo "✓ mamba version: $(mamba --version)"
          else
            echo "⚠ conda/mamba is NOT installed (may have been skipped)"
          fi
      
      - name: Verify yadm and Dotfiles
        if: matrix.phase == 2 || matrix.phase == 3
        run: |
          echo "Verifying yadm setup..."
          
          if command -v yadm &> /dev/null; then
            echo "✓ yadm is installed: $(which yadm)"
            echo "✓ yadm version: $(yadm --version)"
            
            # Check if yadm repo exists
            if yadm rev-parse --git-dir &> /dev/null; then
              echo "✓ yadm repository is initialized"
              
              # Check for remote
              REMOTE=$(yadm remote get-url origin 2>/dev/null || echo "")
              if [ -n "$REMOTE" ]; then
                echo "✓ yadm remote is set: $REMOTE"
              else
                echo "⚠ yadm remote is NOT set"
              fi
              
              # Check for common dotfiles
              DOTFILES=(".zshrc" ".gitconfig" ".config")
              for dotfile in "${DOTFILES[@]}"; do
                if [ -f "$HOME/$dotfile" ] || [ -d "$HOME/$dotfile" ]; then
                  echo "✓ Dotfile $dotfile exists"
                else
                  echo "⚠ Dotfile $dotfile does NOT exist (may not be cloned yet)"
                fi
              done
            else
              echo "⚠ yadm repository is NOT initialized"
            fi
          else
            echo "⚠ yadm is NOT installed"
          fi
      
      - name: Verify Scripts Exist
        run: |
          echo "Verifying all scripts are present and executable..."
          test -f linux/setup_linux.sh && echo "✓ linux/setup_linux.sh exists"
          test -f scripts/install_package_manager.sh && echo "✓ install_package_manager.sh exists"
          test -f scripts/install_essential_tools.sh && echo "✓ install_essential_tools.sh exists"
          test -f scripts/setup_shell.sh && echo "✓ setup_shell.sh exists"
          test -f scripts/setup_python.sh && echo "✓ setup_python.sh exists"
          test -f scripts/setup_nodejs.sh && echo "✓ setup_nodejs.sh exists"
          test -f scripts/setup_conda.sh && echo "✓ setup_conda.sh exists"
          test -f config/conda.yml && echo "✓ config/conda.yml exists"
          test -f common/lib.sh && echo "✓ common/lib.sh exists"

  test-config-files:
    name: Validate Configuration Files
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Validate YAML syntax
        run: |
          echo "Validating YAML configuration files..."
          python3 -c "import yaml; yaml.safe_load(open('config/homebrew.yml'))" && echo "✓ config/homebrew.yml is valid YAML"
          python3 -c "import yaml; yaml.safe_load(open('config/conda.yml'))" && echo "✓ config/conda.yml is valid YAML"
        continue-on-error: true
      
      - name: Check config file structure
        run: |
          echo "Checking configuration file structure..."
          test -f config/homebrew.yml && echo "✓ config/homebrew.yml exists"
          test -f config/conda.yml && echo "✓ config/conda.yml exists"
          
          # Check for required keys in homebrew.yml
          grep -q "^packages:" config/homebrew.yml && echo "✓ homebrew.yml has 'packages' key" || echo "⚠ homebrew.yml missing 'packages' key"
          grep -q "^casks:" config/homebrew.yml && echo "✓ homebrew.yml has 'casks' key" || echo "⚠ homebrew.yml missing 'casks' key"
          
          # Check for required keys in conda.yml
          grep -q "^channels:" config/conda.yml && echo "✓ conda.yml has 'channels' key" || echo "⚠ conda.yml missing 'channels' key"
          grep -q "^conda_packages:" config/conda.yml && echo "✓ conda.yml has 'conda_packages' key" || echo "⚠ conda.yml missing 'conda_packages' key"
          grep -q "^environment_name:" config/conda.yml && echo "✓ conda.yml has 'environment_name' key" || echo "⚠ conda.yml missing 'environment_name' key"
          grep -q "environment_name: py3" config/conda.yml && echo "✓ conda.yml uses 'py3' as default environment" || echo "⚠ conda.yml does not use 'py3' as default"

  lint-scripts:
    name: Lint Shell Scripts
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Install shellcheck
        run: |
          sudo apt-get update
          sudo apt-get install -y shellcheck
      
      - name: Lint shell scripts
        run: |
          echo "Linting shell scripts..."
          find . -name "*.sh" -type f ! -path "./.git/*" -exec shellcheck {} \; || echo "Some linting issues found (non-blocking)"
        continue-on-error: true

